<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>지점 상세</title>
  <link rel="stylesheet" href="https://aplusark.mycafe24.com/assets/css/admin.css" />
  <style>
    body { font-family:'Pretendard','Noto Sans KR',sans-serif; }
    .admin-layout { display:flex; min-height:100vh; }
    .sidebar { width:220px; background:#111827; color:#fff; padding:24px 0; }
    .sidebar-logo { padding:0 24px 24px; }
    .sidebar-logo img { max-width:150px; }
    .sidebar-menu { list-style:none; margin:0; padding:0; }
    .sidebar-menu li a { display:block; padding:10px 24px; font-size:14px; color:#9ca3af; text-decoration:none; }
    .sidebar-menu li.active a, .sidebar-menu li a:hover { color:#fff; background:#1f2937; }
    .content { flex:1; background:#f3f4f6; padding:32px; }
    .page-header { margin-bottom:20px; }
    .page-title { font-size:20px; font-weight:700; margin-bottom:4px; }
    .page-desc { font-size:13px; color:#6b7280; }
    .card { background:#fff; border-radius:12px; padding:24px; box-shadow:0 1px 3px rgba(0,0,0,0.06); }
    .field-row { margin-bottom:10px; font-size:14px; }
    .field-label { display:inline-block; width:90px; color:#6b7280; }
    #mapView { width:100%; height:260px; border-radius:8px; border:1px solid #e5e7eb; margin-top:16px; }
    .btn { display:inline-block; padding:8px 14px; border-radius:6px; border:none; font-size:13px; cursor:pointer; text-decoration:none; }
    .btn-primary { background:#2563eb; color:#fff; }
    .btn-gray { background:#e5e7eb; color:#111827; }
    .btn-danger { background:#ef4444; color:#fff; }
    .btn-wrap { text-align:right; margin-top:20px; display:flex; justify-content:flex-end; gap:10px; }
  </style>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_APP_KEY&libraries=services"></script>
</head>
<body>
<div class="admin-layout">
  <aside class="sidebar">
    <div class="sidebar-logo"><img src="https://aplusark.mycafe24.com/assets/images/logo.png" alt="광성메디멕스" /></div>
    <ul class="sidebar-menu">
      <li><a href="notice_list.html">공지사항</a></li>
      <li><a href="news_list.html">광성소식</a></li>
      <li><a href="pru_list.html">제품관리</a></li>
      <li class="active"><a href="branch_list.html">지점 관리</a></li>
    </ul>
  </aside>
  <main class="content">
    <div class="page-header">
      <div class="page-title">지점 상세</div>
      <div class="page-desc">등록된 지점 정보를 확인합니다.</div>
    </div>
    <div class="card">
      <div class="field-row"><span class="field-label">카테고리</span><span id="vCategory"></span></div>
      <div class="field-row"><span class="field-label">지점명</span><span id="vName"></span></div>
      <div class="field-row"><span class="field-label">주소</span><span id="vAddr"></span></div>
      <div class="field-row"><span class="field-label">연락처</span><span id="vTel"></span></div>
      <div class="field-row"><span class="field-label">등록일</span><span id="vDate"></span></div>
      <div id="mapView"></div>
      <div class="btn-wrap">
        <button type="button" class="btn btn-gray" onclick="location.href='branch_list.html'">목록</button>
        <button type="button" class="btn btn-primary" id="editBtn">수정</button>
        <button type="button" class="btn btn-danger" id="deleteBtn">삭제</button>
      </div>
    </div>
  </main>
</div>
<script>
  const STORAGE_KEY = 'branchList';
  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  let branches = [];
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    const parsed = raw ? JSON.parse(raw) : [];
    branches = Array.isArray(parsed) ? parsed : [];
  } catch(e) { branches = []; }
  const item = branches.find(b => String(b.id) === String(id));
  const vCategory = document.getElementById('vCategory');
  const vName = document.getElementById('vName');
  const vAddr = document.getElementById('vAddr');
  const vTel = document.getElementById('vTel');
  const vDate = document.getElementById('vDate');
  let map, marker, geocoder;
  function initMap() {
    const container = document.getElementById('mapView');
    const center = new kakao.maps.LatLng(37.5665, 126.9780);
    const options = { center, level: 5 };
    map = new kakao.maps.Map(container, options);
    marker = new kakao.maps.Marker({ position: center });
    marker.setMap(map);
    geocoder = new kakao.maps.services.Geocoder();
    if (item) {
      if (item.lat && item.lng) {
        const pos = new kakao.maps.LatLng(item.lat, item.lng);
        map.setCenter(pos);
        marker.setPosition(pos);
      } else if (item.addr) {
        geocoder.addressSearch(item.addr, function(result, status) {
          if (status === kakao.maps.services.Status.OK) {
            const lat = parseFloat(result[0].y);
            const lng = parseFloat(result[0].x);
            const pos = new kakao.maps.LatLng(lat, lng);
            map.setCenter(pos);
            marker.setPosition(pos);
          }
        });
      }
    }
  }
  if (!item) {
    vName.textContent = '해당 지점을 찾을 수 없습니다.';
  } else {
    vCategory.textContent = item.category || '';
    vName.textContent = item.name || '';
    vAddr.textContent = item.addr || '';
    vTel.textContent = item.tel || '';
    vDate.textContent = item.date || '';
  }
  document.getElementById('editBtn').addEventListener('click', function() {
    if (!item) return;
    location.href = 'branch_write.html?id=' + encodeURIComponent(item.id);
  });
  document.getElementById('deleteBtn').addEventListener('click', function() {
    if (!item) return;
    if (!confirm('삭제하시겠습니까?')) return;
    const list = branches.filter(b => String(b.id) !== String(item.id));
    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    alert('삭제되었습니다.');
    location.href = 'branch_list.html';
  });
  window.onload = function() { initMap(); };
</script>
</body>
</html>
