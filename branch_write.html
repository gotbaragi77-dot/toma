<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>지점 등록 / 수정</title>
  <link rel="stylesheet" href="https://aplusark.mycafe24.com/assets/css/admin.css">

  <!-- 카카오 지도 API (좌표 변환에만 사용) -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b01e52780e00b92cf39aa9715d2b0db0&libraries=services"></script>

  <!-- 카카오 주소 검색 -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

  <style>
    body { font-family:'Pretendard','Noto Sans KR',sans-serif; margin:0; }
    .admin-layout { display:flex; min-height:100vh; }
    .sidebar { width:220px; background:#111827; color:#fff; padding:24px 0; }
    .sidebar-menu li a { display:block; padding:10px 24px; color:#9ca3af; text-decoration:none; }
    .sidebar-menu li.active a, .sidebar-menu li a:hover { color:#fff; background:#1f2937; }
    .content { flex:1; background:#f3f4f6; padding:32px; }
    .card { background:#fff; border-radius:12px; padding:24px; }

    .row-line { margin-bottom:20px; }
    .row-label { font-size:14px; font-weight:600; margin-bottom:6px; }
    .input { width:100%; padding:10px; border:1px solid #d1d5db; border-radius:6px; }

    .btn { padding:8px 14px; border-radius:6px; cursor:pointer; }
    .btn-primary { background:#2563eb; color:#fff; }
    .btn-gray { background:#e5e7eb; }
  </style>
</head>

<body>

<div class="admin-layout">

  <aside class="sidebar">
    <ul class="sidebar-menu">
      <li><a href="notice_list.html">공지사항</a></li>
      <li><a href="news_list.html">광성소식</a></li>
      <li><a href="pru_list.html">제품관리</a></li>
      <li class="active"><a href="branch_list.html">지점 관리</a></li>
    </ul>
  </aside>

  <main class="content">
    <div class="card">

      <!-- 카테고리 -->
      <div class="row-line">
        <div class="row-label">카테고리</div>
        <select id="category" class="input">
          <option>광성메디멕스</option>
          <option>지원랩</option>
        </select>
      </div>

      <!-- 지점명 -->
      <div class="row-line">
        <div class="row-label">지점명</div>
        <input type="text" id="name" class="input" />
      </div>

      <!-- 주소 -->
      <div class="row-line">
        <div class="row-label">주소</div>
        <div style="display:flex; gap:8px;">
          <input type="text" id="addr" class="input" placeholder="주소 검색을 클릭하세요" readonly />
          <button class="btn btn-gray" onclick="searchAddress()">주소검색</button>
        </div>
        <input type="text" id="addrDetail" class="input" placeholder="상세주소 입력">
      </div>

      <!-- 연락처 -->
      <div class="row-line">
        <div class="row-label">연락처</div>
        <input type="text" id="tel" class="input" placeholder="예) 031-000-0000" />
      </div>

      <!-- 숨겨진 좌표 -->
      <input type="hidden" id="lat">
      <input type="hidden" id="lng">

      <!-- 버튼 -->
      <div style="text-align:right;">
        <button class="btn btn-gray" onclick="location.href='branch_list.html'">취소</button>
        <button class="btn btn-primary" onclick="saveBranch()">저장</button>
      </div>

    </div>
  </main>

</div>

<script>
let geocoder = new kakao.maps.services.Geocoder();

/* 주소 검색 */
function searchAddress() {
  new daum.Postcode({
    oncomplete: function(data) {

      document.getElementById("addr").value = data.address;

      /* 방금 입력한 주소 → 좌표 변환 */
      geocoder.addressSearch(data.address, function(result, status) {
        if (status === kakao.maps.services.Status.OK) {
          document.getElementById("lat").value = result[0].y;
          document.getElementById("lng").value = result[0].x;
        }
      });
    }
  }).open();
}

/* 저장 */
function saveBranch() {
  const data = {
    id: Date.now(),
    category: category.value,
    name: name.value,
    addr: addr.value,
    addrDetail: addrDetail.value,
    fullAddr: addr.value + " " + addrDetail.value,
    tel: tel.value,
    lat: lat.value,
    lng: lng.value
  };

  fetch("save_branch.php", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  .then(r => r.text())
  .then(() => {
    alert("저장되었습니다");
    location.href = "branch_list.html";
  });
}
</script>

</body>
</html>
