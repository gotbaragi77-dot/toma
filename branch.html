<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì§€ì ì°¾ê¸° | ê´‘ì„±ë©”ë””ë©•ìŠ¤</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/9dc619267f.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://www.zionelab.com/assets/css/style.css" />
  <!-- âœ… ì‹¤ì œ JavaScript í‚¤ë¡œ êµì²´ -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b01e52780e00b92cf39aa9715d2b0db0&libraries=services"></script>
  <style>
    body { font-family:'Pretendard','Noto Sans KR',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; margin:0; padding:0; }
    .header { position: fixed; top: 0; left: 0; width: 100%; background: #fff; z-index: 1000; border-bottom: 1px solid #eee; }
    .header-inner { max-width: 1400px; margin: 0 auto; padding: 0 60px; display: flex; align-items: center; justify-content: space-between; height: 80px; position: relative; }
    .logo img { height: 32px; }
    .nav ul { display: flex; gap: 48px; list-style: none; align-items: center; margin: 0; padding: 0; }
    .nav li { cursor: pointer; font-weight: 500; color: #333; font-size: 15px; position: relative; padding: 0; }
    .nav li:hover { color: #0a2e26; }
    .dealer-btn { background: #0a2e26; color: #fff; padding: 10px 28px; border-radius: 20px; text-decoration: none; font-weight: 500; font-size: 14px; white-space: nowrap; }
    .dealer-btn:hover { background:#083922; color:#fff; }
    .mega-menu { position: absolute; top: 80px; left: 0; width: 100%; background: #fff; border-top: 1px solid #e5e5e5; box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: none; padding: 26px 0 40px 0; min-height: 400px; z-index: 999; }
    .mega-inner { max-width: 1400px; margin: 0 auto; padding: 0 60px; display: flex; justify-content: flex-start; gap: 48px; position: relative; }
    .mega-section { min-width: 120px; }
    .mega-section ul { list-style:none; margin:0; padding:0; }
    .mega-section li { margin-bottom: 14px; font-size: 13px; color: #666; transition: color 0.2s ease; white-space: nowrap; cursor: pointer; }
    .mega-section li:hover { color:#0a2e26; }
    main { margin-top:80px; }
    .sub-title { background: url('https://aplusark.mycafe24.com/assets/images/sub_bg.png') center/cover no-repeat; padding: 100px 0; text-align: center; color: #fff; position: relative; }
    .sub-title::before { content:''; position:absolute; top:0;left:0;right:0;bottom:0; background:rgba(0,0,0,0.3); }
    .sub-title-content { position:relative; z-index:1; }
    .sub-title h1 { font-size:42px; font-weight:700; margin-bottom:10px; }
    .sub-title p { font-size:16px; opacity:0.9; }
    .branch-section { padding:60px 0 100px 0; }
    .branch-section .container { max-width:1200px; }
    .branch-tabs { display:flex; gap:10px; margin-bottom:20px; }
    .branch-tab { padding:8px 18px; border-radius:20px; border:1px solid #ddd; background:#f9fafb; font-size:14px; cursor:pointer; }
    .branch-tab.active { background:#111827; border-color:#111827; color:#fff; }
    .branch-filters { display:flex; gap:10px; margin-bottom:16px; }
    .branch-filters select, .branch-filters input { border:1px solid #d1d5db; border-radius:6px; padding:8px 10px; font-size:13px; }
    .branch-search-btn { padding:8px 16px; border-radius:6px; border:1px solid #111827; background:#111827; color:#fff; font-size:13px; cursor:pointer; white-space:nowrap; }
    .branch-layout { display:grid; grid-template-columns: minmax(0, 360px) minmax(0, 1fr); gap:16px; }
    .branch-list-wrap { border:1px solid #e5e7eb; border-radius:8px; background:#fff; padding:16px; height:540px; display:flex; flex-direction:column; }
    .branch-total { font-size:13px; margin-bottom:8px; color:#6b7280; }
    .branch-list { list-style:none; margin:0; padding:0; overflow-y:auto; flex:1; }
    .branch-item { padding:10px 8px; border-bottom:1px solid #f3f4f6; cursor:pointer; }
    .branch-item:last-child { border-bottom:none; }
    .branch-item.active { background:#f0f9ff; }
    .branch-name { font-size:14px; font-weight:600; margin-bottom:4px; }
    .branch-addr, .branch-tel { font-size:12px; color:#4b5563; line-height:1.4; }
    #map { border-radius:8px; border:1px solid #e5e7eb; width:100%; height:540px; }
    .footer { background: #5a4a3a !important; color: #fff !important; padding: 40px 0 !important; }
    .footer-logo img { filter: brightness(0) invert(1); height: 50px; }
    .footer-copyright p { color: #ddd !important; font-size: 14px; line-height: 1.6; }
    .footer-links { display: flex; gap: 20px; margin-bottom: 15px; }
    .footer-links a { color: #fff !important; text-decoration: none; font-size: 14px; font-weight: 500; transition: opacity 0.3s; }
    .footer-links a:hover { opacity: 0.8; }
    .footer-info p { color: #ddd !important; font-size: 13px; line-height: 1.7; }
    @media (max-width: 992px) { .header-inner { padding:0 20px; } .branch-layout { grid-template-columns:1fr; } #map { height:360px; } }
  </style>
</head>
<body>
<header class="header">
  <div class="header-inner">
    <div class="logo">
      <a href="/"><img src="https://www.zionelab.com/assets/images/logo.svg" alt="ZIONE LAB ë¡œê³ " /></a>
    </div>
    <nav class="nav">
      <ul class="main-menu">
        <li class="menu-item">ì§€ì›ë©</li>
        <li class="menu-item">ë¸Œëœë“œì†Œê°œ</li>
        <li class="menu-item">ì œí’ˆì†Œê°œ</li>
        <li class="menu-item">ê´‘ì„±ë©”ë””ë©•ìŠ¤ì†Œê°œ</li>
        <li class="menu-item">ë§¤ì¥ì•ˆë‚´</li>
        <li class="menu-item">ê³ ê°ì„¼í„°</li>
        <li class="menu-item">ê´‘ì„±ìœ í†µ</li>
      </ul>
    </nav>
    <a href="/pages/partner/" class="dealer-btn">ëŒ€ë¦¬ì  ëª¨ì§‘</a>
  </div>
  <div class="mega-menu">
    <div class="mega-inner" id="megaInner"></div>
  </div>
</header>
<main>
  <section class="sub-title">
    <div class="sub-title-content">
      <h1>ì§€ì ì°¾ê¸°</h1>
      <p>ê°€ê¹Œìš´ ì§€ì ì„ ê²€ìƒ‰í•˜ê³  ë°©ë¬¸í•´ë³´ì„¸ìš”.</p>
    </div>
  </section>
  <section class="branch-section">
    <div class="container">
      <div class="branch-tabs mb-3">
        <button class="branch-tab active" data-cat="ì „ì²´">ì „ì²´</button>
        <button class="branch-tab" data-cat="ê´‘ì„±ë©”ë””ë©•ìŠ¤">ê´‘ì„±ë©”ë””ë©•ìŠ¤</button>
        <button class="branch-tab" data-cat="ì§€ì›ë©">ì§€ì›ë©</button>
      </div>
      <div class="branch-filters mb-3">
        <select id="sidoFilter"><option value="">ì‹œ/ë„ ì „ì²´</option></select>
        <select id="gugunFilter"><option value="">êµ¬/êµ° ì „ì²´</option></select>
        <input type="text" id="keyword" placeholder="ì§€ì ëª… ë˜ëŠ” ì£¼ì†Œ ê²€ìƒ‰" style="flex:1; min-width:160px;" />
        <button class="branch-search-btn" id="searchBtn">ê²€ìƒ‰</button>
      </div>
      <div class="branch-layout">
        <div class="branch-list-wrap">
          <div class="branch-total" id="branchTotal">ì´ 0ê°œì˜ ì§€ì ì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤</div>
          <ul class="branch-list" id="branchList"></ul>
        </div>
        <div id="map"></div>
      </div>
    </div>
  </section>
</main>
<footer class="footer">
  <div class="container">
    <div class="row align-items-start">
      <div class="col-md-4">
        <div class="footer-logo mb-3"><img src="https://www.zionelab.com/assets/images/logo.svg" alt="ê´‘ì„±ë©”ë””ë©•ìŠ¤" /></div>
        <div class="footer-copyright">
          <p class="mb-1">Copyright Â© 2025</p>
          <p class="mb-0">(ì£¼)ê´‘ì„±ë©”ë””ë©•ìŠ¤. All rights reserved.</p>
        </div>
      </div>
      <div class="col-md-8">
        <div class="footer-links mb-3">
          <a href="/">HOME</a>
          <a href="#">ì´ìš©ì•½ê´€</a>
          <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
          <a href="#">ì‚¬ì—…ìì •ë³´</a>
        </div>
        <div class="footer-info">
          <p class="mb-1">ìƒí˜¸: (ì£¼)ê´‘ì„±ë©”ë””ë©•ìŠ¤ | ëŒ€í‘œì: ì¥ì„±ì‹ | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 855-87-03219</p>
          <p class="mb-1">ë³¸ì‚¬: ê²½ê¸°ë„ í•˜ë‚¨ì‹œ ë¯¸ì‚¬ê°•ë³€ì„œë¡œ 25, ë¯¸ì‚¬ì„¼ìŠ¤íƒ€ì›Œ ì§€ì‹ì‚°ì—…ì„¼í„° 10ì¸µ 57í˜¸</p>
          <p class="mb-0">ê³ ê°ì„¼í„°: (T) 031.8027.2094 | (F) 070.8277.3500 | (E) zionelab@zionelab.com</p>
        </div>
      </div>
    </div>
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const menuData = [
    {items: ['ì§€ì›ë©ì†Œê°œ', 'ê¸°ìˆ ë ¥', 'ì§€ì›ìº¡ 900']},
    {items: ['ì¸ì‚¬ë§', 'íšŒì‚¬ì—°í˜', 'ê´‘ì„±ê¸°ìˆ ë ¥', 'ì´ë…', 'ì˜¤ì‹œëŠ”ê¸¸']},
    {items: ['ì§€ì›ëŒ900', 'ê·¼ì ì™¸ì„ ë§ˆì‚¬ì§€ê¸°', 'ê·¼ì ì™¸ì„ ê°•ê³µê¸°', 'ê·¼ì ì™¸ì„ ì¼€ì–´íŒ¨ë“œ', 'ìê´‘ì„ì•ˆë§ˆì˜ì', 'ê·¼ì ì™¸ì„ ì•ˆë§ˆì˜ì', 'ì§€ì›ë¯¸ìƒ´í‘¸', 'ì§€ì›ë¯¸ë¹„ëˆ„', 'ë°”ì´ì˜¤ì…€ë³¼ë¥¨ì•°í”Œ', 'ì§€ì›ë¯¸ì¹˜ì•½', 'ì§€ì›ë¯¸íŒ”ì°Œ']},
    {items: ['ê´‘ì„±ë©”ë””ë©•ìŠ¤', 'ì§€ì›ë¯¼ì‚¬íšŒ', 'ì§€ì›ëŒì‚¬ìš©ê¸°', 'ì§€ì›ëŒí›„ìš©', 'ì§€ì›ëŒìƒ']},
    {items: ['ëŒ€ë¦¬ì ì•ˆë‚´', 'ì§€ì ì°¾ê¸°']},
    {items: ['ê³µì§€ì‚¬í•­', 'FAQ']},
    {items: ['ì œí’ˆì†Œê°œ', 'ì œí’ˆì¡°íšŒ']}
  ];

  $(function() {
    /* ë©”ê°€ë©”ë‰´ ì›ë³¸ ë¡œì§ ìœ ì§€ */
    function createMegaMenu() {
      const $megaInner = $('#megaInner');
      $megaInner.empty();
      const $menuItems = $('.menu-item');
      $menuItems.each(function(i) {
        const $item = $(this);
        const position = $item.position();
        const $section = $('<div class="mega-section"></div>').css({ position: 'absolute', left: position.left });
        const $ul = $('<ul></ul>');
        (menuData[i] ? menuData[i].items : []).forEach(t => $ul.append('<li>' + t + '</li>'));
        $section.append($ul);
        $megaInner.append($section);
      });
    }
    createMegaMenu();
    $(window).resize(() => { if ($('.mega-menu').is(':visible')) createMegaMenu(); });
    $('.menu-item').mouseenter(() => { $('.mega-menu').stop(true, true).slideDown(250); createMegaMenu(); });
    $('.header').mouseleave(() => { $('.mega-menu').stop(true, true).slideUp(250); });

    /* âœ… ì—¬ê¸°ì„œë¶€í„° ì§€ì  ë°ì´í„° ë¡œë”©/í‘œì‹œ ë¡œì§ */

    let branches = [];                       // ì „ì²´ ì§€ì  ë°ì´í„°
    const mapContainer = document.getElementById('map');
    let map, marker, geocoder;

    function initMap() {
      const center = new kakao.maps.LatLng(37.5665, 126.9780);
      const options = { center, level: 7 };
      map = new kakao.maps.Map(mapContainer, options);
      marker = new kakao.maps.Marker({ position: center });
      marker.setMap(map);
      geocoder = new kakao.maps.services.Geocoder(); // ì§€ë„ ì´ˆê¸°í™” í›„ geocoder ìƒì„±
    }

    function moveMap(lat, lng) {
      const pos = new kakao.maps.LatLng(lat, lng);
      map.panTo(pos);
      marker.setPosition(pos);
    }

    // âœ… localStorage + admin/branch_data.json ë¶ˆëŸ¬ì˜¤ê¸°
    function loadBranches() {
      const STORAGE_KEY = 'branchList';
      let localData = [];

      // 1. localStorageì—ì„œ ë¨¼ì € ì½ê¸°
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        console.log('ğŸ“¦ localStorage ì›ë³¸ ë°ì´í„°:', raw);
        const parsed = raw ? JSON.parse(raw) : [];
        localData = Array.isArray(parsed) ? parsed : [];
        console.log('âœ… localStorage íŒŒì‹± ì™„ë£Œ:', localData.length, 'ê°œ ì§€ì ');
        if (localData.length > 0) {
          console.log('ì²« ë²ˆì§¸ ì§€ì  ìƒ˜í”Œ:', localData[0]);
        }
      } catch(e) {
        console.error('âŒ localStorage ì½ê¸° ì‹¤íŒ¨:', e);
        localData = [];
      }

      // 2. JSON íŒŒì¼ë„ ì‹œë„
      return fetch("admin/branch_data.json?" + Date.now())
        .then(res => {
          console.log('ğŸŒ JSON íŒŒì¼ ì‘ë‹µ:', res.status, res.ok);
          if (!res.ok) return localData;
          return res.json();
        })
        .then(data => {
          if (!Array.isArray(data)) {
            console.log('âš ï¸ JSON ë°ì´í„° ì—†ìŒ, localStorage ì‚¬ìš©');
            return localData;
          }

          console.log('ğŸ“„ JSON íŒŒì¼ ë°ì´í„°:', data.length, 'ê°œ ì§€ì ');

          // JSON íŒŒì¼ê³¼ localStorage ë°ì´í„° ë³‘í•© (ì¤‘ë³µ ì œê±°)
          const allBranches = [...localData, ...data];
          const uniqueBranches = [];
          const ids = new Set();

          allBranches.forEach(b => {
            if (!ids.has(b.id)) {
              ids.add(b.id);
              uniqueBranches.push(b);
            }
          });

          console.log('ğŸ”€ ë³‘í•© ì™„ë£Œ:', uniqueBranches.length, 'ê°œ ì§€ì ');
          return uniqueBranches;
        })
        .catch((err) => {
          console.error('âŒ JSON íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', err);
          console.log('ğŸ’¾ localStorage ë°ì´í„° ì‚¬ìš©:', localData.length, 'ê°œ');
          return localData;
        }); // ì˜¤ë¥˜ ì‹œ localStorage ë°ì´í„° ë°˜í™˜
    }

    function buildSidoGugun(list) {
      const sidoSet = new Set();
      const gugunSet = new Set();
      list.forEach(b => {
        if (b.sido) sidoSet.add(b.sido);
        if (b.gugun) gugunSet.add(b.gugun);
      });
      const $sido = $('#sidoFilter');
      const $gugun = $('#gugunFilter');
      $sido.find('option:not(:first)').remove();
      $gugun.find('option:not(:first)').remove();
      Array.from(sidoSet).forEach(s => $sido.append('<option value="'+s+'">'+s+'</option>'));
      Array.from(gugunSet).forEach(g => $gugun.append('<option value="'+g+'">'+g+'</option>'));
    }

    function filterBranches() {
      const activeCat = $('.branch-tab.active').data('cat');
      const sido = $('#sidoFilter').val();
      const gugun = $('#gugunFilter').val();
      const keyword = $('#keyword').val().trim();

      return branches.filter(b => {
        if (activeCat !== 'ì „ì²´' && b.category !== activeCat) return false;
        if (sido && b.sido !== sido) return false;
        if (gugun && b.gugun !== gugun) return false;
        if (keyword) {
          const text = ((b.name || '') + ' ' + (b.fullAddr || b.addr || '')).toLowerCase();
          if (!text.includes(keyword.toLowerCase())) return false;
        }
        return true;
      });
    }

    function renderList() {
      const list = filterBranches();
      const $list = $('#branchList');
      const $total = $('#branchTotal');
      $list.empty();
      $total.text('ì´ ' + list.length + 'ê°œì˜ ì§€ì ì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤');

      if (!list.length) {
        $list.append('<li class="branch-item">ë“±ë¡ëœ ì§€ì ì´ ì—†ìŠµë‹ˆë‹¤.</li>');
        return;
      }

      list.forEach((b, idx) => {
        const li = document.createElement('li');
        li.className = 'branch-item' + (idx === 0 ? ' active' : '');
        li.dataset.id = b.id;
        li.innerHTML =
          '<div class="branch-name">'+ (b.name || '') +'</div>' +
          '<div class="branch-addr">'+ (b.fullAddr || b.addr || '') +'</div>' +
          '<div class="branch-tel">'+ (b.tel || '') +'</div>';

        li.addEventListener('click', function() {
          document.querySelectorAll('.branch-item').forEach(el => el.classList.remove('active'));
          this.classList.add('active');

          if (b.lat && b.lng) {
            moveMap(b.lat, b.lng);
          } else if (b.addr) {
            geocoder.addressSearch(b.addr, function(result, status) {
              if (status === kakao.maps.services.Status.OK) {
                const lat = parseFloat(result[0].y);
                const lng = parseFloat(result[0].x);
                moveMap(lat, lng);
              }
            });
          }
        });
        $list.append(li);
      });

      const first = list[0];
      if (first) {
        if (first.lat && first.lng) {
          moveMap(first.lat, first.lng);
        } else if (first.addr) {
          geocoder.addressSearch(first.addr, function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
              const lat = parseFloat(result[0].y);
              const lng = parseFloat(result[0].x);
              moveMap(lat, lng);
            }
          });
        }
      }
    }

    // íƒ­ / í•„í„° ì´ë²¤íŠ¸ ê·¸ëŒ€ë¡œ ìœ ì§€
    $('.branch-tab').on('click', function() {
      $('.branch-tab').removeClass('active');
      $(this).addClass('active');
      renderList();
    });
    $('#searchBtn').on('click', function() { renderList(); });
    $('#sidoFilter, #gugunFilter').on('change', function() { renderList(); });

    // âœ… ì´ˆê¸° ì‹¤í–‰: ì¹´ì¹´ì˜¤ë§µ ë¡œë“œ ëŒ€ê¸° í›„ ì‹¤í–‰
    function init() {
      console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
      initMap();
      loadBranches().then(list => {
        console.log('ğŸ“Š ìµœì¢… branches ë°°ì—´:', list);
        console.log('ğŸ“Š branches ê°œìˆ˜:', list.length);
        branches = list;
        buildSidoGugun(branches);
        renderList();
        console.log('âœ¨ renderList ì™„ë£Œ');
      });
    }

    // ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ëŒ€ê¸°
    if (typeof kakao !== 'undefined' && kakao.maps) {
      init();
    } else {
      // ì¹´ì¹´ì˜¤ë§µ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ëŒ€ê¸°
      const checkKakao = setInterval(() => {
        if (typeof kakao !== 'undefined' && kakao.maps) {
          clearInterval(checkKakao);
          init();
        }
      }, 100);
    }
  });
</script>
</body>
</html>
